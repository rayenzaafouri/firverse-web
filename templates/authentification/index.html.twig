{# templates/auth.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}FIRVERSE Authentification{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="https://cdn.jsdelivr.net/npm/vue@3.2.47/dist/vue.global.min.js"></script>
{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <style>
        body {
            height: 100lvh;
            background-color: black;
            background-image: url("{{ asset('images/login/background.png') }}");
            background-repeat: no-repeat;
            background-size: cover;
            padding: 1rem;
        }
        .branding > img {
            width: 10rem;
        }
        .auth {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding-top: 10lvh;
        }
        .auth-container {
            display: flex;
            flex-direction: row;
            flex-wrap: nowrap;
            gap: 3rem;
            justify-content: center;
            border-radius: 1rem;
            width: fit-content;
            padding: 2rem;
            background-color: white;
            border: 4px solid #7cb64c;
        }
        .nav {
            font-size: .75rem;
            width: fit-content;
            border-radius: 0.375rem;
            background-color: #eeeeee;
        }
        .nav .nav-link {
            border: unset;
            cursor: pointer;
        }
        .nav-link-left {
            border-top-left-radius: 0.375rem;
            border-bottom-left-radius: 0.375rem;
        }
        .nav-link-right {
            border-top-right-radius: 0.375rem;
            border-bottom-right-radius: 0.375rem;
        }
        .nav-link.active {
            background-color: #7cb64c;
            color: white !important;
        }
        .nav-link:not(.active) {
            color: rgb(74,72,72);
        }
    </style>
{% endblock %}

{% block body %}
<div id="switchable-auth" class="auth mt-5">
  <div class="auth-container shadow p-3 mb-5">

    <div class="branding text-center">
      <img src="{{ asset('images/landing/fitverse-logo.png') }}" alt="Fitverse logo">
      <p>Enter your credentials to continue.</p>

      <ul class="nav nav-pills">
        <li class="nav-item">
          <button
            class="nav-link nav-link-left"
            :class="{ active: activeTab==='login' }"
            @click="activeTab='login'"
          >Login</button>
        </li>
        <li class="nav-item">
          <button
            class="nav-link nav-link-right"
            :class="{ active: activeTab==='register' }"
            @click="activeTab='register'"
          >Register</button>
        </li>
      </ul>
    </div>

    <div class="tab-content mt-3 bg-body rounded">

      {# —— LOGIN —— #}
      <div v-show="activeTab==='login'">
        <form action="{{ path('app_auth_login') }}" method="post">
          <input type="hidden" name="_csrf_token" value="{{ csrf_token('authenticate') }}">

          <div class="mb-3">
            <label for="loginEmail" class="form-label">Email</label>
            <input
              type="email"
              id="loginEmail"
              name="_username"
              class="form-control"
              value="{{ last_username|default('') }}"
              required autofocus
            >
          </div>

          <div class="mb-3">
            <label for="loginPassword" class="form-label">Password</label>
            <input
              type="password"
              id="loginPassword"
              name="_password"
              class="form-control"
              required
            >
          </div>

          <button type="submit" class="btn btn-fitverse">Login</button>

          
        </form>
      </div>

      {# —— REGISTER —— #}
      <div v-show="activeTab==='register'">
        {{ form_start(registrationForm, {
            action: path('app_register'),
            method: 'POST',
            attr: { novalidate: 'novalidate', enctype: 'multipart/form-data' }
        }) }}

          <div class="mb-3">
            {{ form_label(registrationForm.first_name, null, { 'label_attr': { 'class': 'form-label' } }) }}
            {{ form_widget(registrationForm.first_name, { 'attr': { 'class': 'form-control' } }) }}
            <div class="text-danger">{{ form_errors(registrationForm.first_name) }}</div>
          </div>

          <div class="mb-3">
            {{ form_label(registrationForm.last_name, null, { 'label_attr': { 'class': 'form-label' } }) }}
            {{ form_widget(registrationForm.last_name, { 'attr': { 'class': 'form-control' } }) }}
            <div class="text-danger">{{ form_errors(registrationForm.last_name) }}</div>
          </div>

          <div class="mb-3">
            {{ form_label(registrationForm.email, null, { 'label_attr': { 'class': 'form-label' } }) }}
            {{ form_widget(registrationForm.email, { 'attr': { 'class': 'form-control' } }) }}
            <div class="text-danger">{{ form_errors(registrationForm.email) }}</div>
          </div>

          <div class="mb-3">
            {{ form_label(registrationForm.address, null, { 'label_attr': { 'class': 'form-label' } }) }}
            {{ form_widget(registrationForm.address, { 'attr': { 'class': 'form-control' } }) }}
            <div class="text-danger">{{ form_errors(registrationForm.address) }}</div>
          </div>

          <div class="mb-3">
            {{ form_label(registrationForm.phone, null, { 'label_attr': { 'class': 'form-label' } }) }}
            {{ form_widget(registrationForm.phone, { 'attr': { 'class': 'form-control' } }) }}
            <div class="text-danger">{{ form_errors(registrationForm.phone) }}</div>
          </div>

          <div class="mb-3">
            {{ form_label(registrationForm.plainPassword, null, { 'label_attr': { 'class': 'form-label' } }) }}
            {{ form_widget(registrationForm.plainPassword, { 'attr': { 'class': 'form-control' } }) }}
            <div class="text-danger">{{ form_errors(registrationForm.plainPassword) }}</div>
          </div>

          <div class="mb-3">
            {{ form_label(registrationForm.gender, null, { 'label_attr': { 'class': 'form-label' } }) }}
            {{ form_widget(registrationForm.gender, { 'attr': { 'class': 'form-control' } }) }}
            <div class="text-danger">{{ form_errors(registrationForm.gender) }}</div>
          </div>

          <div class="mb-3">
            {{ form_label(registrationForm.birth_date, null, { 'label_attr': { 'class': 'form-label' } }) }}
            {{ form_widget(registrationForm.birth_date, { 'attr': { 'class': 'form-control' } }) }}
            <div class="text-danger">{{ form_errors(registrationForm.birth_date) }}</div>
          </div>

          <div class="mb-3">
            {{ form_label(registrationForm.image, null, { 'label_attr': { 'class': 'form-label' } }) }}
            {{ form_widget(registrationForm.image, { 'attr': { 'class': 'form-control' } }) }}
            <div class="text-danger">{{ form_errors(registrationForm.image) }}</div>
          </div>

          <button type="submit" class="btn btn-fitverse">Register</button>

        {{ form_end(registrationForm) }}
      </div>

    </div>
  </div>
</div>

<script>
  const { createApp } = Vue;
  createApp({
    data() {
      return {
        activeTab: '{{ activeTab|default("login") }}'
      };
    }
  }).mount('#switchable-auth');
</script>
{% endblock %}
