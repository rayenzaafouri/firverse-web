{% extends 'base.html.twig' %}

{% block title %}
{{ exercice.title }} - Fitverse
{% endblock %}



{% block javascripts %}
{{ parent() }}
<script>

    const iconMap = {
        "1": "barbell.png",
        "2": "dumbells.png",
        "3": "bodyweight.png",
        "4": "machine.png",
        "5": "medicine-ball.png",
        "6": "kettlebells.png",
        "7": "stretches.png",
        "8": "cables.png",
        "9": "band.png",
        "10": "plate.png",
        "11": "trx.png",
        "12": "yoga.png",
        "13": "bosu-ball.png",
        "14": "vitruvian.png",
        "15": "cardio.png",
        "16": "smith-machine.png",
        "17": "recovery.png",
    };



    document.addEventListener("DOMContentLoaded", (event) => {


        let equipment = JSON.parse(new DOMParser().parseFromString("{{ exercice.equipment }}", "text/html").documentElement.textContent)
        const targetDiv = document.querySelector(".equipment-icons")

        equipment.forEach(item => {
            let image = document.createElement("img")
            image.src = "/icons/" + iconMap[item]
            image.alt = iconMap[item]
            targetDiv.appendChild(image)

        })
    })



</script>

<script>
    //Renders steps

    document.addEventListener("DOMContentLoaded", (event) => {

        const stepElement = (text, video, number = "?") => {

            const cloningDiv = document.querySelector(".steps > .step").cloneNode(true)
            cloningDiv.querySelector(".step-description").innerHTML = text
            cloningDiv.querySelector(".step-video").src = video
            cloningDiv.querySelector(".step-count").innerHTML = "#" + number
            cloningDiv.classList.remove("json-assist")
            return cloningDiv
        }

        let steps = JSON.parse(new DOMParser().parseFromString("{{ exercice.steps }}", "text/html").documentElement.textContent)

        let stepCounter = 0;
        steps.forEach(step => {
            stepCounter++
            const newStep = stepElement(step.text, step.video, stepCounter)
            document.querySelector(".steps").appendChild(newStep)

        })
    })

</script>
{% endblock %}


{% block stylesheets %}
{{ parent() }}
{# Your CSS goes here #}
<style>
    .header {
        display: flex;
        margin: 1rem;
        flex-direction: row;
        align-items: center;
        padding : 0 10lvw;

    }

    .details {
        width: 40lvw;
        display: flex;
        flex-direction: column;
        gap: .5rem;

        img {
            object-fit: cover;
        }
    }

    .json-assist {
        display: none !important;
    }

    .exercise-view {
        display: flex;
        flex-direction: row-reverse;
        gap: 1rem;
        height:84lvh;
        overflow:hidden;
        padding : 0 10lvw;

    }


    .body-maps {
        display: flex;
        gap: 1rem;
        background: #E8E8E8;
        border-radius: 0.875rem;
        padding: .5rem;
        height: 40lvh;
        display: flex;
        align-items: center;
        height: fit-content;
        width: 100%;
        align-items: center;
        justify-content: center;

        transition: transform .33s ease;

        &:hover {
            transform: scale(1.02);
        }


        img {
            object-fit: cover;
            height: 25lvh;
        }
    }

    .sets-reps {
        width: fit-content;
        display: flex;
        gap: 1rem;
        background: #E8E8E8;
        padding: .5rem 1rem;
        border-radius: 0.875rem;

        div {
            display:flex;
            text-align: center;
        }
    }

    .equipment-icons {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        justify-content: center;
        gap: .5rem;
        padding: 1rem;

        img {
            height: 2rem;
            width: auto;
        }
    }

    .steps {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        width: fit-content;
        margin: 0 .5rem;

        .step {
            background: #E8E8E8;
            display: grid;
            grid-template-columns: 3fr 1fr;
            border-radius: 0.875rem;
            position: relative;
            transition: transform .33s ease;

            &:hover {
                transform: scale(1.02);
            }

            .step-count {
                position: absolute;
                left: 0;
                top: 0;
                background: #c5c5c5;
                padding: .5rem;
                border-top-left-radius: 0.875rem;
                border-bottom-right-radius: 0.875rem;
                font-weight: 600;
            }

            div {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                margin: 0 1rem;
            }

        }


        video {
            aspect-ratio: 16/9;
            height: 12rem;
            border-top-right-radius: 0.875rem;
            border-bottom-right-radius: 0.875rem;

        }
    }


    .video-guide {

        iframe {
            border-radius: 0.875rem;
            width: 100%;
            height: 25lvh;

        }
    }

    
    .general-info {
            display: flex;
            flex-direction: row;
            align-items: start;
            flex-wrap: wrap;
            gap: .5rem;
            align-items: stretch;
            justify-content: center;

            &>div{
                background-color: #E8E8E8;
                border-radius: 0.875rem;
                padding: .5rem;

                display: flex;
                align-items: center;
                gap: .5rem;

                transition: transform .33s ease;
                &:hover {
                    transform: scale(1.02);
                }



            }
        }

    .difficulty-badge {
        display: flex;
        flex-direction: row;
        width: fit-content;
        align-items: center;
        justify-content: center;
        background: #e8e8e8;
        color: black;
        padding: 1rem;
        height: 3rem;
        border-radius: 0.875rem;
        gap: .5rem;
        scale: 0.8;
        position: relative;

        .progress {
            width: 3rem;
            height: 1rem;
            border: 1px solid gray;
            position: relative;
            margin-left: 1rem;
            width: 4rem;
        }

        .emoji {
            left: 1rem;
            scale: 3.2;
            margin-left: .5rem;
            z-index: 3;
            position: absolute;
        }

        .difficulty-label {
            text-transform: capitalize;
            font-size: 1rem;
        }


    }
</style>
{% endblock %}



{% block body %}
{% include 'navbar.html.twig' %}

<body data-context="exercise">

    <div class="header">
        <h2>{{ exercice.title }}</h2>


        <div class="difficulty-badge badge">



            {% if exercice.difficulty == 'novice' %}

            <span class="emoji">ðŸ”¥</span>
            <div class="progress" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                <div class="progress-bar novice" style="width: 35%"></div>
            </div>
            {% endif %}


            {% if exercice.difficulty == 'beginner' %}

            <span class="emoji">ðŸ”¥</span>
            <div class="progress" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                <div class="progress-bar intermediate" style="width: 50%"></div>
            </div>


            {% endif %}


            {% if exercice.difficulty == 'intermediate' %}

            <span class="emoji">ðŸ”¥</span>
            <div class="progress intermediate" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                <div class="progress-bar intermediate" style="width: 70%"></div>
            </div>


            {% endif %}



            {% if exercice.difficulty == 'advanced' %}

            <span class="emoji">ðŸ”¥</span>
            <div class="progress advanced" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                <div class="progress-bar" style="width:95%"></div>
            </div>


            {% endif %}

            <span class="difficulty-label">{{ exercice.difficulty }}</span>

        </div>


        {% if exercice.difficulty == 'beginner' %}
        <span class="material-symbols-outlined">
            fitness_center
        </span>
        <span class="material-symbols-outlined">
            signal_cellular_2_bar
        </span>
        {% endif %}


        {% if exercice.difficulty == 'intermediate' %}
        <span class="material-symbols-outlined">
            fitness_center
        </span>
        <span class="material-symbols-outlined">
            signal_cellular_3_bar
        </span>
        {% endif %}


        {% if exercice.difficulty == 'advanced' %}
        <span class="material-symbols-outlined">
            fitness_center
        </span>
        <span class="material-symbols-outlined">
            signal_cellular_4_bar
        </span>
        {% endif %}

    </div>

    <div class="exercise-view">

        <div>
            <div class="steps">
                <div class="step json-assist">
                    <div>
                        <span class="step-count">#?</span>
                        <p class="step-description"></p>
                    </div>

                    <video class="step-video" autoplay muted loop></video>

                </div>



            </div>

    
        </div>





        <div class="details">

            <div class="video-guide">
                <iframe src="{{ exercice.videoUrl }}" frameborder="0"></iframe>
            </div>


            <div class="body-maps">
                <img src="{{ exercice.bodyMapFront }}" alt="Impacted muscles front side">
                <img src="{{ exercice.bodyMapBack }}" alt="Impacted muscles back side">
            </div>

  


            <div class="general-info">

                <div>
                    <span>Equipment</span>
                    <div class="equipment-icons">
                    </div>
                </div>


                <div class="sets-reps">
                    <div>
                        <span>Sets</span>
                        <span>{{exercice.sets}}</span>

                    </div>

                    <div>
                        <span>Reps</span>
                        <span>{{exercice.reps}}</span>
                    </div>

                </div>


                <div>
                    <span>Grip type</span>
                    <span class="badge badge-pill text-bg-dark">{{ exercice.grips | capitalize }} </span>
                </div>


                <div>

                    <span>Mechanic</span>

                    {% if exercice.push %}
                    <span class="badge badge-pill text-bg-dark">Push</span>
                    {% endif %}

                    {% if exercice.pull %}
                    <span class="badge badge-pill text-bg-dark">Pull</span>
                    {% endif %}

                </div>




                <div>
                    <span>Impacted Muscles</span>
                    <div class="muscle-class">
                        {% if exercice.m_primary %}
                        <span class="badge badge-pill text-bg-success">Primary</span>
                        {% endif %}

                        {% if exercice.m_secondary %}
                        <span class="badge badge-pill text-bg-warning">Secondary</span>

                        {% endif %}


                        {% if exercice.m_tertiary %}
                        <span class="badge badge-pill text-bg-danger">Tertiary</span>
                        {% endif %}
                    </div>
                </div>


            </div>

        </div>

    </div>



</body>

{% endblock %}