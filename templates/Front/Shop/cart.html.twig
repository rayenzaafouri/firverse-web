{% extends 'base.html.twig' %}

{% block title %}My Cart{% endblock %}

{% block body %}
{% include 'navbar.html.twig' %}

<body data-context="shop">
{# data-context value should be one of the values "exercise","gym","events","shop","nutrition" or "user" depending on your module  #}

<div class="container">
    <div class="row justify-content-center mb-4">
    <div class="col-md-6">
        <form action="{{ path('cart_apply_coupon') }}" method="POST" class="form-inline justify-content-center">
            <div class="form-group mx-sm-3 mb-2">
                <input type="text" name="coupon_code" class="form-control" placeholder="Enter coupon code">
            </div>
            <button type="submit" class="btn btn-primary mb-2">Apply Coupon</button>
        </form>

        {% for message in app.flashes('success') %}
            <div class="alert alert-success mt-3">{{ message }}</div>
        {% endfor %}
        {% for message in app.flashes('error') %}
            <div class="alert alert-danger mt-3">{{ message }}</div>
        {% endfor %}
    </div>
</div>

    {% if cartItems is not empty %}
        <div class="table-responsive ">
            <table class="table border-none">
                <thead>
                    <tr>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th>Price</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in cartItems %}
                        <tr>
                            <td><img src="{{ item.product.imageUrl }}" alt="{{ item.product.name }}"  width="80"></td>
                            <td>{{ item.product.name }}</td>
                            <td class="d-flex align-items-center">
                               <div class="d-inline-flex align-items-center border border-warning rounded-pill px-4 py-1" style="background-color: white; border-radius: 200rem !important;border-width: 3px !important;"> 
                                    <a href="{{ path('cart_decrease', {'id': item.product.id}) }}" class="text-dark text-decoration-none font-weight-bold" style="font-size: 1rem; line-height: 1;">-</a>
                                    <span class="mx-3 font-weight-bold" style="font-size: 1.3rem; line-height: 1;">{{ item.quantity }}</span>
                                    <a href="{{ path('cart_increase', {'id': item.product.id}) }}" class="text-dark text-decoration-none font-weight-bold" style="font-size: 1rem; line-height: 1;">+</a>
                                </div>
                            </td>
                            <td>
                                <a href="{{ path('cart_remove', {'id': item.product.id}) }}" >Remove</a>
                            </td>
                            <td>{{ item.product.price }} USD</td>

                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        {% set finalTotal = total %}
        {% if app.session.get('coupon') %}
            {% set discount = app.session.get('coupon').discount %}
            {% set finalTotal = total * (1 - discount / 100) %}
        {% endif %}

        <div class="text-right font-weight-bold mt-4">
            {% if app.session.get('coupon') %}
                <p class="text-success">Coupon "{{ app.session.get('coupon').code }}" applied: -{{ discount }}%</p>
            {% endif %}
            <h4>Subtotal ({{ cartItems|length }} items): {{ finalTotal|number_format(2) }} USD</h4>
        </div>

        <a href="{{ path('checkout') }}" class="btn d-inline-flex align-items-center border border-warning text-dark font-weight-bold bg-warning rounded-pill px-4 py-1 row justify-content-center mb-4" style=" border-radius: 200rem !important;border-width: 3px !important;">Proceed to Checkout</a>
    {% else %}
        <p class="text-center text-muted">Your cart is empty.</p>
    {% endif %}
</div>

</body>
{% endblock %}
