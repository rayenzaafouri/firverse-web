{% extends 'base.html.twig' %}

{% block title %}Food{% endblock %}

{% block body %}
    <div class="container-fluid py-5 mt-5" style="background: #f7fafc; min-height: 100vh;">
    <div class="row justify-content-center align-items-stretch">
        <div class="col-lg-5 mb-4 mb-lg-0 order-lg-1 d-flex">
            <div class="card shadow rounded-4 border-0 p-4 h-100 w-100 d-flex flex-column align-items-center justify-content-center" style="background: #fff; min-height: 480px;">
                <div id="caloriesPieChart" style="width: 100%; max-width:340px; height: 260px;"></div>
                <h1 class="fw-bold display-5 mt-4 mb-1 text-center">{{ food.name|title }}</h1>
                <div class="text-muted mb-4 text-center">Detailed nutrition breakdown and calorie source</div>
                <div class="text-center w-100 mt-auto">
                    <a href="{{ path('app_food_index') }}" class="btn btn-outline-secondary me-2 btn-lg" style="transition:box-shadow 0.2s;">
                        <i class="fas fa-arrow-left"></i> Back to list
                    </a>
                    <a href="{{ path('app_food_edit', {'id': food.id}) }}" class="btn btn-outline-primary btn-lg" style="transition:box-shadow 0.2s;">
                        <i class="fas fa-edit"></i> Edit
                    </a>
                    {{ include('food/_delete_form.html.twig') }}
                </div>
            </div>
        </div>
        <div class="col-lg-5 d-flex order-lg-2">
            <div class="card shadow rounded-4 border-0 p-3 h-100 w-100 d-flex flex-column justify-content-center" style="background: #fff; max-width:340px; min-height: 480px;">
                <div style="border-bottom:8px solid #000; padding:0.5rem 1rem 0.25rem 1rem;">
                    <h2 style="font-size:2rem; font-weight:bold; margin:0; letter-spacing:-2px;">Nutrition Facts</h2>
                </div>
                <div style="padding:0.25rem 1rem 0.25rem 1rem; border-bottom:3px solid #000; font-weight:bold;">
                    Portion Size <span style="float:right">{{ food.grams|default('100') }} g</span>
                </div>
                <div style="padding:0.25rem 1rem 0.25rem 1rem; border-bottom:3px solid #000;">
                    <span style="font-weight:bold; font-size:1.2rem;">Amount Per Portion</span>
                </div>
                <div style="padding:0.25rem 1rem 0.25rem 1rem; border-bottom:8px solid #000; display:flex; align-items:end;">
                    <span style="font-size:2rem; font-weight:bold;">Calories</span>
                    <span style="margin-left:auto; font-size:2.5rem; font-weight:bold;">{{ food.calories|default(0) }}</span>
                </div>
                <div style="padding:0.25rem 1rem 0.25rem 1rem; border-bottom:2px solid #000; font-size:0.95rem; font-weight:bold; display:flex;">
                    <span style="flex:1;">&nbsp;</span>
                    <span>% Daily Value *</span>
                </div>
                <div style="padding:0.1rem 1rem 0.1rem 1rem; border-bottom:1px solid #000; font-size:1rem;">
                    <span style="font-weight:bold;">Total Fat</span> {{ food.fats|default(0) }}g
                    <span style="float:right">0%</span>
                </div>
                <div style="padding:0.1rem 1rem 0.1rem 1rem; border-bottom:1px solid #000; font-size:1rem;">
                    <span style="margin-left:1.5em;">Saturated Fat</span> {{ food.saturatedFats|default(0) }}g
                    <span style="float:right">0%</span>
                </div>
                <div style="padding:0.1rem 1rem 0.1rem 1rem; border-bottom:1px solid #000; font-size:1rem;">
                    <span style="font-weight:bold;">Sodium</span> {{ food.sodium|default(0) }}mg
                    <span style="float:right">0%</span>
                </div>
                <div style="padding:0.1rem 1rem 0.1rem 1rem; border-bottom:1px solid #000; font-size:1rem;">
                    <span style="font-weight:bold;">Total Carbohydrate</span> {{ food.carbohydrate|default(0) }}g
                    <span style="float:right">8%</span>
                </div>
                <div style="padding:0.1rem 1rem 0.1rem 1rem; border-bottom:1px solid #000; font-size:1rem;">
                    <span style="margin-left:1.5em;">Dietary Fiber</span> {{ food.fibre|default(0) }}g
                    <span style="float:right">9%</span>
                </div>
                <div style="padding:0.1rem 1rem 0.1rem 1rem; border-bottom:1px solid #000; font-size:1rem;">
                    <span style="margin-left:1.5em;">Sugar</span> {{ food.sugar|default(0) }}g
                    <span style="float:right">0%</span>
                </div>
                <div style="padding:0.1rem 1rem 0.1rem 1rem; border-bottom:1px solid #000; font-size:1rem;">
                    <span style="font-weight:bold;">Protein</span> {{ food.protein|default(0) }}g
                    <span style="float:right">2%</span>
                </div>
                <div style="padding:0.1rem 1rem 0.1rem 1rem; border-bottom:1px solid #000; font-size:1rem;">
                    <span style="font-weight:bold;">Cholesterol</span> {{ food.cholesterol|default(0) }}mg
                    <span style="float:right">0%</span>
                </div>
                <div style="padding:0.1rem 1rem 0.1rem 1rem; border-bottom:1px solid #000; font-size:1rem;">
                    <span style="font-weight:bold;">Magnesium</span> {{ food.magnesium|default(0) }}mg
                    <span style="float:right">0%</span>
                </div>
                <div style="padding:0.1rem 1rem 0.5rem 1rem; font-size:0.9rem; color:#777;">
                    * % Daily Values are based on a 2,000 calorie diet.
                </div>
            </div>

            
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(drawChart);
    function drawChart() {
        // Calculate calories from macros (Fat: 9 cal/g, Protein: 4 cal/g, Carbs: 4 cal/g)
        var fat = parseFloat("{{ food.fats|default(0) }}");
        var protein = parseFloat("{{ food.protein|default(0) }}");
        var carbs = parseFloat("{{ food.carbohydrate|default(0) }}");
        var fatCal = fat * 9;
        var proteinCal = protein * 4;
        var carbCal = carbs * 4;
        var totalCal = fatCal + proteinCal + carbCal;
        if (totalCal === 0) totalCal = 1; // prevent div by zero
        var fatPct = Math.round(fatCal / totalCal * 100);
        var proteinPct = Math.round(proteinCal / totalCal * 100);
        var carbPct = 100 - fatPct - proteinPct;
        var data = google.visualization.arrayToDataTable([
          ['Source', 'Percent'],
          ['Fat', fatPct],
          ['Protein', proteinPct],
          ['Carbs', carbPct]
        ]);
        var colors = ['#e6e2b6', '#ffb3b3', '#dedeff'];
        var chart = new google.visualization.PieChart(document.getElementById('caloriesPieChart'));
        chart.draw(data, {
            title: 'Calories by source',
            pieHole: 0.4,
            legend: { position: 'right', alignment: 'center', textStyle: { fontSize: 15 } },
            slices: { 0: { color: colors[0] }, 1: { color: colors[1] }, 2: { color: colors[2] } },
            pieSliceText: 'percentage',
            chartArea: { width: '80%', height: '80%' },
            titleTextStyle: { bold: true, fontSize: 16 },
            fontName: 'Arial',
        });
    }
</script>

{% endblock %}
