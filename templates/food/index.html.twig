{% extends 'base.html.twig' %}

{% block title %}Food index{% endblock %}

{% block body %}
{% include 'navbar.html.twig' %}
    <div class="container mt-4">
        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                <h1 class="h3 mb-0">Food List</h1>
                <a href="{{ path('app_food_new') }}" class="btn btn-light">
                    <i class="fas fa-plus"></i> Create new
                </a>
            </div>
            <div class="card-body">
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text">
                                    <i class="fas fa-search"></i>
                                </span>
                            </div>
                            <input type="text" id="foodSearch" class="form-control" placeholder="Search foods...">
                        </div>
                    </div>
                </div>

                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="thead-dark">
                            <tr>
                                <th>Id</th>
                                <th>Name</th>
                                <th>Measure</th>
                                <th>Grams</th>
                                <th>Calories</th>
                                <th>Protein</th>
                                <th>Fats</th>
                                <th>SaturatedFats</th>
                                <th>Fibre</th>
                                <th>Carbohydrate</th>
                                <th>Sugar</th>
                                <th>Cholesterol</th>
                                <th>Sodium</th>
                                <th>Magnesium</th>
                                <th>Times_used</th>
                                <th>actions</th>
                            </tr>
                        </thead>
                        <tbody id="foodTable">
                            {% for food in food %}
                                <tr>
                                    <td>{{ food.id }}</td>
                                    <td>{{ food.name }}</td>
                                    <td>{{ food.measure }}</td>
                                    <td>{{ food.grams }}</td>
                                    <td>{{ food.calories }}</td>
                                    <td>{{ food.protein }}</td>
                                    <td>{{ food.fats }}</td>
                                    <td>{{ food.saturatedFats }}</td>
                                    <td>{{ food.fibre }}</td>
                                    <td>{{ food.carbohydrate }}</td>
                                    <td>{{ food.sugar }}</td>
                                    <td>{{ food.cholesterol }}</td>
                                    <td>{{ food.sodium }}</td>
                                    <td>{{ food.magnesium }}</td>
                                    <td>{{ food.timesUsed }}</td>
                                    <td>
                                        <a href="{{ path('app_food_show', {'id': food.id}) }}" class="btn btn-sm btn-info">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                        <a href="{{ path('app_food_edit', {'id': food.id}) }}" class="btn btn-sm btn-warning">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                    </td>
                                </tr>
                            {% else %}
                                <tr>
                                    <td colspan="16" class="text-center">no records found</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('foodSearch');
            const foodTable = document.getElementById('foodTable');
            const rows = foodTable.getElementsByTagName('tr');
            
            searchInput.addEventListener('keyup', function() {
                const searchText = searchInput.value.toLowerCase();
                
                for (let i = 0; i < rows.length; i++) {
                    const row = rows[i];
                    const cells = row.getElementsByTagName('td');
                    let found = false;
                    
                    // Skip the "no records found" row
                    if (cells.length === 1 && cells[0].getAttribute('colspan')) {
                        continue;
                    }
                    
                    // Check each cell in the row
                    for (let j = 0; j < cells.length; j++) {
                        const cellText = cells[j].textContent || cells[j].innerText;
                        if (cellText.toLowerCase().indexOf(searchText) > -1) {
                            found = true;
                            break;
                        }
                    }
                    
                    // Show/hide the row based on search result
                    row.style.display = found ? '' : 'none';
                }
                
                // Check if any rows are visible
                let visibleRows = 0;
                for (let i = 0; i < rows.length; i++) {
                    if (rows[i].style.display !== 'none') {
                        visibleRows++;
                    }
                }
                
                // Show "no results" message if needed
                const noResultsRow = foodTable.querySelector('tr[colspan="16"]');
                if (noResultsRow) {
                    if (visibleRows === 0 && searchText !== '') {
                        noResultsRow.style.display = '';
                    } else {
                        noResultsRow.style.display = 'none';
                    }
                }
            });
        });
    </script>
{% endblock %}
